{
  "hash": "c903885278a9f065592e6e88ba6898c8",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Crafting Publication Quality Data Visualizations with `ggplot2`\"\nauthor: \"Eric R. Scott\"\nformat: \n  html: \n    code-link: true\n    code-tools: true\n    toc: true\neditor: visual\nexecute: \n  warning: false\nbibliography: references.bib\n---\n\n\n::: callout-note\n## Learning Objectives\n\n-   Customize color palettes with accessibility in mind\n-   Customize appearance of plots with themes\n-   Customizing axes (ticks, grid-lines, labels, date axes, transformations)\n-   Create custom legends\n-   Save high resolution or vector formats\n-   Arrange multi-panel figures\n:::\n\n## Required by journals\n\nJournals often require certain modifications to your plots to make them publication-ready\n\n-   High resolution\n-   Specific file types (TIFF, EPS, PDF are common)\n-   Figure size limits\n-   Font size suggestions\n\n## Not required, but good practice\n\nOther modifications to the appearance of your plot are a good idea, but less often required by journals or reviewers\n\n-   Colorblind accessible colors\n-   Grey scale friendly colors\n-   Perceptually-even colors\n-   Screen-reader compatible\n-   High [data-ink ratio](https://infovis-wiki.net/wiki/Data-Ink_Ratio) (simplify plot, within reason)\n-   Arrangement of related plots into multi-panel figures\n\n## Example plots\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(palmerpenguins)\n```\n:::\n\n\nA version of the plot from part 1 of this workshop series is re-created here.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\np1 <-\n  ggplot(data = penguins |> \n           filter(!is.na(sex)),\n         mapping = aes(x = species, \n                       y = body_mass_g,\n                       shape = sex)) +\n  geom_point(\n    alpha = 0.15,\n    position = position_jitterdodge(dodge.width = 0.75)\n  ) +\n  stat_summary(\n    fun.data = mean_sdl,\n    position = position_dodge(width = 0.75)\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np1\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nIn addition, I'll create two more basic plots for practice combining plots into multi-panel figures.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n#bill length vs. flipper length\np2 <-\n  ggplot(penguins,\n         aes(\n           x = flipper_length_mm,\n           y = bill_length_mm,\n           color = species,\n           fill = species,\n           shape = species\n         )) +\n  geom_point() +\n  geom_smooth(method = \"lm\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np2\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# flipper length to mass ratio vs. bill_length\np3 <-\n  ggplot(penguins,\n         aes(\n           x = flipper_length_mm,\n           y = bill_depth_mm,\n           color = species,\n           fill = species,\n           shape = species\n         )) +\n  geom_point() +\n  geom_smooth(method = \"lm\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np3\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n## Color\n\nThere are many ways to change plot colors, including using built-in palettes, packages that add color palettes, and manually.\nIt's usually best to choose a color palette that meets these criteria:\n\n-   Colorblind friendly\n-   Greyscale friendly\n-   Perceptually even\n-   High contrast (with background & eachother)\n\nThe viridis color palettes built in to `ggplot2` generally meet these criteria and are a good choice for many visualizations.\n\nHere's an example plot with a color bar:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nv <- \n  ggplot(\n    penguins,\n    aes(x = bill_length_mm, y = bill_depth_mm, color = body_mass_g)\n  ) +\n  geom_point()\nv\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nFor a continuous color scale use `scale_color_viridis_c()`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nv + scale_color_viridis_c()\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nOther palettes are available by changing `option`\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Variations with option = \"A\" through \"H\"\nv + scale_color_viridis_c(option = \"B\")\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nA binned version is available with `scale_color_viridis_b()`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nv + scale_color_viridis_b(option = \"B\", n.breaks = 5)\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\nThe viridis palettes tend to end on a very bright yellow, which doesn't look great on light backgrounds, especially on a projector.\nYou can \"cap\" the scale using `begin` and `end`.\n\nE.g. Begin at 10% in to skip the darkest purples and end at 90% to skip the brightest yellows\n\n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\nv + scale_color_viridis_c()\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n\n```{.r .cell-code}\nv + scale_color_viridis_c(begin = 0.1, end = 0.9)\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-12-2.png){width=672}\n:::\n:::\n\n\n### Discrete colors\n\nOur initial example plot uses just 3 colors, but we can still use viridis to ensure they are colorblind friendly and perceptually even using `scale_color_viridis_d()` for \"discrete\".\nThe colors still follow a gradient from cool to warm.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np2 + scale_color_viridis_d(end = 0.9, option = \"C\")\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\nTo apply the same color scale to both \"fill\" and \"color\", you can use the `aesthetics` argument to `scale_color_*` or `scale_fill_*` functions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np2 + \n  scale_color_viridis_d(end = 0.9, option = \"C\", aesthetics = c(\"fill\", \"color\"))\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n### Manual color palette\n\nMaybe you don't like the viridis palettes or maybe you want a palette more appropriate for diverging or discrete data.\nThere are a ***ton*** of tools for generating color palettes---both R packages that extend ggplot2 and external tools.\n\nPackages and resources to check out:\n\n-   [`colorspace`](https://hclwizard.org/r-colorspace/) [@zeileis2019colorspace]\n-   [`cols4all`](https://github.com/mtennekes/cols4all)\n-   [`paletteer`](https://emilhvitfeldt.github.io/paletteer/)\n-   [Comprehensive list of color palettes in r](https://github.com/EmilHvitfeldt/r-color-palettes#readme)\n\nYou can use *any* set of colors as a custom palette with `scale_color_manual()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_cols <- c(\"#B60A1C\",\"#E39802\",\"#309143\")\n\np2 + scale_color_manual(values = my_cols, aesthetics = c(\"color\", \"fill\"))\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\nSpecify which color goes with which factor level by using a named vector.\n\n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\nmy_cols <- \n  c(\"Chinstrap\" = \"#B60A1C\", \"Gentoo\" = \"#E39802\", \"Adelie\" = \"#309143\")\np2 <- p2 + \n  scale_color_manual(values = my_cols, aesthetics = c(\"color\", \"fill\"))\np2\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n\n```{.r .cell-code}\np3 <- p3 +\n  scale_color_manual(values = my_cols, aesthetics = c(\"color\", \"fill\"))\np3\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-16-2.png){width=672}\n:::\n:::\n\n\n## Labeling scales\n\nEach scale (color, fill, shape), including x and y axes, can have a label.\nThere are multiple ways to set this, but I'll demonstrate setting it with `labs()`\n\n\n::: {.cell}\n\n```{.r .cell-code}\np2 + labs(color = \"Penguin Species\")\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\nThis creates a separate legend for color.\nGuides with the same name will get combined when possible.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np2 + \n  labs(\n    color = \"Penguin Species\",\n    shape = \"Penguin Species\",\n    fill = \"Penguin Species\"\n  )\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\nWe can also use `labs()` to re-name the axes\n\n\n::: {.cell}\n\n```{.r .cell-code}\np2 <- p2 + \n  labs(\n    color = \"Penguin Species\",\n    shape = \"Penguin Species\",\n    fill = \"Penguin Species\",\n    x = \"Flipper Length (mm)\",\n    y = \"Bill Length (mm)\"\n  )\np2\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np3 <- p3 + \n  labs(\n    color = \"Penguin Species\",\n    shape = \"Penguin Species\",\n    fill = \"Penguin Species\",\n    x = \"Flipper Length (mm)\",\n    y = \"Bill Depth (mm)\"\n  )\np3\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- p1 +\n  labs(x = \"Species\", y = \"Body Mass (g)\", shape = \"Sex\")\np1\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\n## Custom Axes\n\nAxes are a type of scale and can be modified with ggplot2 functions like `scale_x_continuous()` for continuous data, `scale_x_discrete()` for discrete data, etc.\n\nOur first plot has a discrete x axis and a continuous y axis.\nWe can use a `scale_*()` to change the x-axis labels (there are other ways to do this of course) and adjust the number of breaks on the y-axis\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscinames <-\n  c(\"Adelie\" = \"P. adeliae\", \"Chinstrap\" = \"P. antarticus\", \"Gentoo\" = \"P. papua\")\np1 <- \n  p1 + scale_x_discrete(labels = scinames) + scale_y_continuous(n.breaks = 12)\np1 \n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\nYou'll notice that `n.breaks=12` doesn't produce *exactly* 12 breaks---it preferences \"pretty\" breaks at whole numbers and tries to get *about* as many breaks as you asked for.\nSupply a numeric vector to `breaks` if you want to specify the breaks **exactly.**\n\n### Axis limits\n\nYou can set the range of an axis two ways, and the choice of which way is consequential.\nSetting limits inside of `scale_()` crops the *data* while `coord_cartesian()` only crops the plotting area.\nWith `ylim(2000, 5500)` the mean and standard error for our largest penguins are re-drawn using the cropped data while they are unaffected by `coord_cartesian()` (except that they go off the edge of the plotting area now)\n\n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\np1 + scale_y_continuous(limits = c(2000, 5500), n.breaks = 12)\n```\n\n::: {.cell-output-display}\n![Limits set in scale_y_*() or with ylim()](notes_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# p1 + ylim(2000, 5500) #shortcut if you only want to change limits\np1 + coord_cartesian(ylim = c(2000, 5500))\n```\n\n::: {.cell-output-display}\n![Limits set in coord_cartesian()](notes_files/figure-html/unnamed-chunk-23-2.png){width=672}\n:::\n:::\n\n\n<!--# breaks, labels, scales, xlim() vs. coord_cartesian()? -->\n\nWe can use `coord_flip()` to make a horizontal graph.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 + coord_flip()\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\n::: callout-important\n`coord_flip()` only changes where the x and y axes are ***drawn***.\nIn the plot above, the axis labeled \"species\" is still the x-axis, as far as ggplot2 code is concerned.\n:::\n\n## Customizing appearance with `theme()`\n\n<!--# how to get help with theme(), what element_s are there, show a map of the plot and what stuff is called.  Maybe ask participants to suggest a few changes and we try to figure them out together -->\n\nThere are several complete themes built-in to `ggplot2`, and many more available from other packages.\n\n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\np2 + theme_bw()\n```\n\n::: {.cell-output-display}\n![theme_bw()](notes_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n\n```{.r .cell-code}\np2 + theme_minimal()\n```\n\n::: {.cell-output-display}\n![theme_minimal()](notes_files/figure-html/unnamed-chunk-25-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggthemes)\np1 + theme_solarized()\n```\n\n::: {.cell-output-display}\n![theme_solarized() from ggthemes package](notes_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n\nCustomizing themes \"manually\" involves knowing the name of the theme element and it's corresponding `element_*()` function.\nA good place to start is the help page for `theme()` <https://ggplot2.tidyverse.org/reference/theme.html>\n\n::: callout-tip\nIt's best to find a built-in `theme_*()` function that gets you most of the way there and then customize with `theme()`\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 + \n  theme_minimal() + \n  theme(axis.line = element_line(linewidth = 0.5, lineend = \"round\"))\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\n\n::: callout-note\n## Activity\n\nName some things about the appearance of `p1` that you want to change and we'll figure it out together!\n:::\n\nYou can save your theme as an R object to re-use, or use `theme_set()` at the top of a script to make it the default.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#create a custom theme\nmy_theme <- \n  theme_minimal() + \n  theme(\n    axis.line = element_line(linewidth = 0.5, lineend = \"round\"),\n    axis.ticks = element_line(linewidth = 0.2),\n    legend.background = element_rect(linewidth = 0.2)\n  )\n\n#add to a plot\np2 + my_theme\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-28-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#or set as default\ntheme_set(my_theme)\n\np3\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-28-2.png){width=672}\n:::\n:::\n\n\n## Multi-panel figures\n\n`patchwork` allows simple composistion of multi-panel figures with `ggplot2` plots\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(patchwork)\np1 + p2\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-29-1.png){width=672}\n:::\n:::\n\n\n-   `+` combines plots\n\n-   `|` combines plots side-by-side\n\n-   `/` combines plots vertically\n\n-   `()` can be used to nest operations\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 / (p2 | p3)\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-30-1.png){width=672}\n:::\n:::\n\n\n-   `plot_layout()` controls layout.\n    The *coolest* feature, IMO, is `guides = \"collect\"` which combines duplicate legends\n\n-   `plot_annotation()` is useful for adding labels to panels\n\n\n::: {.cell}\n\n```{.r .cell-code}\np_combined <-\n  p1 /\n  (p2 + p3 + plot_layout(guides = \"collect\")) + \n  plot_annotation(tag_levels = \"a\", tag_suffix = \")\")\np_combined\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n:::\n\n\nYou can also apply layers or themes to all sub-plots by using `&` instead of `+`\n\n\n::: {.cell}\n\n```{.r .cell-code}\np_combined & theme_dark()\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-32-1.png){width=672}\n:::\n:::\n\n\n## Saving plots\n\nAlthough we often leave this step until the end, I think it's good to save your plot to a file early on once the plot starts taking shape.\nIf you have some plot dimensions in mind, this allows you to see how any further changes will look in the finished plot.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\n  filename = \"penguins.png\", # filetype comes from filename extension\n  plot = p_combined, # default is prev. plot, but good to specify\n  width = 7, \n  height = 5, \n  units = \"in\", \n  dpi = \"print\" # resolution for raster images\n)\n```\n:::\n\n\n![](penguins.png)\n\nFor example, with these dimensions (4x3 in.), the points and lines appear quite large and some of the text is probably larger than it needs to be.\nIf we had saved the plot earlier, we wouldn't necessarily have to go back and tweak things.\n\n### Raster vs. Vector\n\nRaster images (e.g. .jpg, .png, .tiff) are made of pixels and the resolution can vary.\nVector images (e.g. .svg, .eps) are not made of pixels and don't have a resolution.\n\n::: callout-tip\nTry zooming in on the images below in your browser to see the difference\n:::\n\n\n::: {.cell}\n\n:::\n\n\n::: {layout-ncol=\"2\"}\n![Raster (72 dpi .png file)](penguins-lores.png){fig-align=\"left\" width=\"300\"}\n\n![Vector (.svg file)](penguins.svg){fig-align=\"left\" width=\"300\"}\n:::\n\nVector images should be used whenever possible and accepted by the journal.\nVector formats are more accessible for screen-readers as well (although you should *always* provide alt-text when possible)\n\n## Getting help\n\nBesides adding `ggplot2` to search terms, there a few good places to look for help or inspiration in improving or modifying the appearance of `ggplot2` plots:\n\n-   The [`ggplot2` documentation](https://ggplot2.tidyverse.org/) itself, in particular the examples on the [`theme()` page](https://ggplot2.tidyverse.org/reference/theme.html#ref-examples) and the [FAQ on customization](https://ggplot2.tidyverse.org/articles/faq-customising.html).\n\n-   The [R Graph Gallery](https://r-graph-gallery.com/) has a wide variety of plots with R code walkthroughs.\n\n-   The `ggplot2` book: <https://ggplot2-book.org/>\n\nYou can always come by our [drop-in hours](https://datascience.cct.arizona.edu/drop-in-hours) to ask questions as well!\n\n## Part 3 next week!\n\n#### \"Exploring the wide world of `ggplot2` extensions\"\n\n🗓️ June 26, 11:00am--1:00pm\n\n::: {style=\"text-align: center;\"}\n[<button style=\"border-radius:4px;background-color:#259443\">Register</button>](https://datascience.cct.arizona.edu/drop-in-hours)\n:::\n",
    "supporting": [
      "notes_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}