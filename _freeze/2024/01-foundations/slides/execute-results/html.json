{
  "hash": "f9385d0834b2ed96f86958770b5cc0b7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Foundations of {ggplot2}\nauthor: Eric R Scott\nformat: \n  uaz-revealjs:\n  # revealjs:\n    incremental: true\ncss: custom.css\nbibliography: references.bib\n---\n\n\n## Learning Objectives\n\n\n\n\n\n-   Learn about the most recent changes in `ggplot2`\n-   Understand the \"grammar of graphics\" and how it inspired `ggplot2`'s design\n-   Know what it means to \"map data to aesthetics\"\n-   Understand the relationship between a \"geom\" and a \"stat\"\n\n------------------------------------------------------------------------\n\n![](https://media.springernature.com/w316/springer-static/cover-hires/book/978-0-387-28695-2?as=webp){fig-align=\"center\"}\n\n## A Grammar of Graphics\n\n-   A book by @wilkinson2005\n-   Inspired the development of *many* graphics programs including `ggplot2` [@wickham2010]\n-   Alternative to having a function for every kind of plot\n-   A framework for layering elements to create any kind of plot\n\n## Grammar of Graphics Components\n\n\n\n\n\n::: columns\n::: {.column width=\"50%\"}\n::: nonincremental\n1.  Data\n2.  Aesthetics\n3.  Scales (and guides)\n4.  Geometric objects\n5.  Statistics\n6.  Facets\n7.  Coordinate system\n:::\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](slides_files/figure-revealjs/unnamed-chunk-3-1.png){width=432}\n:::\n:::\n\n:::\n:::\n\n::: notes\nWe're going to go through each of these and examine how they appear in this example plot\n:::\n\n## Data\n\n::: columns\n::: {.column width=\"50%\"}\nWhat is being visualized?\n\n-   344 observations\n\n-   Body mass measured in grams\n\n-   Bill length measured in mm\n\n-   Three species\n\n-   Three islands\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](slides_files/figure-revealjs/unnamed-chunk-4-1.png){width=432}\n:::\n:::\n\n:::\n:::\n\n## Aesthetics\n\n::: columns\n::: {.column width=\"50%\"}\nWhat visual elements are used to encode data?\n\n-   Color\n\n-   x position\n\n-   y position\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](slides_files/figure-revealjs/unnamed-chunk-5-1.png){width=432}\n:::\n:::\n\n:::\n:::\n\n## Scales (and guides)\n\n<!--# TODO: maybe replace image with annotated one like in 2023 presentation  -->\n\n::: columns\n::: {.column width=\"50%\"}\nWhat range of data is represented and how is it visualized?\n\n-   x-axis continuous from 2700–6300, 4 major breaks\n\n-   y-axis continuous from 32.1–59.6, 3 major breaks\n\n-   Colors are discrete: red, green, blue\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](slides_files/figure-revealjs/unnamed-chunk-6-1.png){width=432}\n:::\n:::\n\n:::\n:::\n\n::: notes\nScales translate data space (in data units) into aesthetic space (e.g. position, color).\nA guide (axis or legend) does the inverse—relates visual properties back to data.\n:::\n\n## Geometric Objects (\"geoms\")\n\n::: columns\n::: {.column width=\"50%\"}\nHow are data represented visually?\n\n-   Data is represented using circles/points\n-   Trend is represented as a line\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](slides_files/figure-revealjs/unnamed-chunk-7-1.png){width=432}\n:::\n:::\n\n:::\n:::\n\n::: notes\nBoth aesthetics and geoms are related to the visual representation of data.\nTo distinguish aesthetics and geoms, think about how geoms can have *many* aesthetics.\nE.g. points have position, shape, size, color, and transparency and different data could be mapped to each of those aesthetics.\n:::\n\n## Statistics (\"stats\")\n\n::: columns\n::: {.column width=\"50%\"}\nWhat calculations or transformations need to be done to present the data?\n\n-   For points, none (stat = \"identity\")\n\n-   For trend lines, linear regression\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](slides_files/figure-revealjs/unnamed-chunk-8-1.png){width=432}\n:::\n:::\n\n:::\n:::\n\n## Facets\n\n::: columns\n::: {.column width=\"50%\"}\nBy what variable are different subsets of the data split apart into \"small multiples\"?\n\n-   Faceted by island\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](slides_files/figure-revealjs/unnamed-chunk-9-1.png){width=432}\n:::\n:::\n\n:::\n:::\n\n::: notes\nNot every plot has facets Plots can be faceted by multiple (2) variables in a grid\n:::\n\n## Coordinate System\n\n::: columns\n::: {.column width=\"50%\"}\nHow are positions represented visually?\n\n-   Cartesian coordinates\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](slides_files/figure-revealjs/unnamed-chunk-10-1.png){width=432}\n:::\n:::\n\n:::\n:::\n\n::: notes\nOther options include polar coordinates or the many possible coordinate systems used in maps.\n:::\n\n## Practice\n\nIdentify each of the seven components of this plot\n\n::: columns\n::: {.column width=\"50%\"}\n::: nonincremental\n1.  Data\n2.  Aesthetics\n3.  Scales\n4.  Geometric Objects\n5.  Statistics\n6.  Facets\n7.  Coordinate System\n:::\n:::\n\n::: {.column width=\"50%\"}\n[![](https://s3.eu-west-1.amazonaws.com/static.gapminder.org/GapminderMedia/wp-uploads/20161215191134/countries_health_wealth_2016_v13.jpg){fig-align=\"center\"}](https://www.gapminder.org/tag/chart/)\n:::\n:::\n\n## Break ⏰\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"countdown\" id=\"timer_0341111c\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;left:0;font-size:5em;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">10</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n\n:::\n:::\n\n\n# `ggplot2` and the Grammar of Graphics\n\n::: notes\nNow we're going to go through each of the seven components and see some examples of how they are implemented in `ggplot2`\n:::\n\n## Data\n\n::: nonincremental\n-   Data is *inherited* by default, but can be overridden for specific layers\n\n-   Worked example: jitter plot of raw data with mean ± standard deviation\n:::\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](slides_files/figure-revealjs/unnamed-chunk-12-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n##  {.smaller}\n\n::: r-stack\n::: fragment\n\n::: {.cell .output6040 output-location='column'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(palmerpenguins)\n\npeng_summary <- \n  penguins |> \n  group_by(island) |> \n  summarize(\n    mean_mass = mean(body_mass_g, na.rm = TRUE),\n    lower_sd = mean_mass - sd(body_mass_g, na.rm = TRUE),\n    upper_sd = mean_mass + sd(body_mass_g, na.rm = TRUE)\n  )\npeng_summary\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 4\n  island    mean_mass lower_sd upper_sd\n  <fct>         <dbl>    <dbl>    <dbl>\n1 Biscoe        4716.    3933.    5499.\n2 Dream         3713.    3296.    4130.\n3 Torgersen     3706.    3261.    4151.\n```\n\n\n:::\n:::\n\n:::\n\n::: fragment\n\n::: {.cell .output6040 output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"15\"}\nlibrary(tidyverse)\nlibrary(palmerpenguins)\n\npeng_summary <- \n  penguins |> \n  group_by(island) |> \n  summarize(\n    mean_mass = mean(body_mass_g, na.rm = TRUE),\n    lower_sd = mean_mass - sd(body_mass_g, na.rm = TRUE),\n    upper_sd = mean_mass + sd(body_mass_g, na.rm = TRUE)\n  )\n# peng_summary\n\nset.seed(123)\nggplot(penguins, aes(x = island, y = body_mass_g)) \n```\n\n::: {.cell-output-display}\n![](slides_files/figure-revealjs/unnamed-chunk-14-1.png){width=432}\n:::\n:::\n\n:::\n\n::: fragment\n\n::: {.cell .output6040 output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"15-16\"}\nlibrary(tidyverse)\nlibrary(palmerpenguins)\n\npeng_summary <- \n  penguins |> \n  group_by(island) |> \n  summarize(\n    mean_mass = mean(body_mass_g, na.rm = TRUE),\n    lower_sd = mean_mass - sd(body_mass_g, na.rm = TRUE),\n    upper_sd = mean_mass + sd(body_mass_g, na.rm = TRUE)\n  )\n# peng_summary\n\nset.seed(123)\nggplot(penguins, aes(x = island, y = body_mass_g)) +\n  geom_jitter(alpha = 0.4)\n```\n\n::: {.cell-output-display}\n![](slides_files/figure-revealjs/unnamed-chunk-15-1.png){width=432}\n:::\n:::\n\n:::\n\n::: fragment\n\n::: {.cell .output6040 output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"17-22|18|19|\"}\nlibrary(tidyverse)\nlibrary(palmerpenguins)\n\npeng_summary <- \n  penguins |> \n  group_by(island) |> \n  summarize(\n    mean_mass = mean(body_mass_g, na.rm = TRUE),\n    lower_sd = mean_mass - sd(body_mass_g, na.rm = TRUE),\n    upper_sd = mean_mass + sd(body_mass_g, na.rm = TRUE)\n  )\n# peng_summary\n\nset.seed(123)\nggplot(penguins, aes(x = island, y = body_mass_g)) +\n  geom_jitter(alpha = 0.4) +\n  geom_pointrange(\n    data = peng_summary,\n    aes(y = mean_mass, ymin = lower_sd, ymax = upper_sd),\n    shape = \"square\",\n    color = \"blue\"\n  )\n```\n\n::: {.cell-output-display}\n![](slides_files/figure-revealjs/unnamed-chunk-16-1.png){width=432}\n:::\n:::\n\n:::\n:::\n\n::: notes\nStart by summarizing the `penguins` dataset to get some summary statistics for the error bars.\nNotice that `ggplot()` uses the raw data though.\\\n\n\\\nThen add the raw data points, in this case with `geom_jitter()`\\\n\\\nThen add the `geom_pointrange()`.\nNotice that we override the inherited data with `data = peng_summary` .\nThe `x` mapping is inherited, but we need to supply new aesthetic mappings for `y`, `ymin`, and `ymax`\n:::\n\n## Aesthetics\n\n::: nonicremental\n-   Aesthetics are *inherited* when placed in `ggplot()` but can also be specified per layer\n-   Aesthetics can be mapped to data or set as constant\n:::\n\n::: notes\nThis might be a good place to look through help files and figure out which aesthetics are valid for mapping\n:::\n\n##  {.smaller}\n\nAesthetic mappings supplied to `ggplot2()` are inherited by all layers\n\n\n::: {.cell output-location='fragment'}\n\n```{.r .cell-code  code-line-numbers=\"1|\"}\nggplot(penguins, aes(x = island, y = body_mass_g, color = sex)) +\n  geom_boxplot() +\n  geom_jitter() \n```\n\n::: {.cell-output-display}\n![](slides_files/figure-revealjs/unnamed-chunk-17-1.png){width=960}\n:::\n:::\n\n\n##  {.smaller}\n\nMappings supplied to a geom only affect that geom.\n\n\n::: {.cell output-location='fragment'}\n\n```{.r .cell-code  code-line-numbers=\"1,3|\"}\nggplot(penguins, aes(x = island, y = body_mass_g)) +\n  geom_boxplot() +\n  geom_jitter(aes(color = sex))\n```\n\n::: {.cell-output-display}\n![](slides_files/figure-revealjs/unnamed-chunk-18-1.png){width=960}\n:::\n:::\n\n\n##  {.smaller}\n\nTurn off inheritance from `ggplot()` for individual geoms with `inherit.aes = FALSE`.\n\n\n::: {.cell output-location='fragment'}\n\n```{.r .cell-code  code-line-numbers=\"2|\"}\nggplot(penguins, aes(x = island, y = body_mass_g, color = sex)) +\n  geom_boxplot(aes(x = island, y = body_mass_g), inherit.aes = FALSE) +\n  geom_jitter()\n```\n\n::: {.cell-output-display}\n![](slides_files/figure-revealjs/unnamed-chunk-19-1.png){width=960}\n:::\n:::\n\n\n##  {.smaller}\n\nSetting an aesthetic (rather than mapping to data with `aes()`)\n\n\n::: {.cell output-location='fragment'}\n\n```{.r .cell-code  code-line-numbers=\"2-3|\"}\nggplot(penguins, aes(x = island, y = body_mass_g, color = sex)) +\n  geom_boxplot(color = \"black\") +\n  geom_jitter(color = \"darkred\")\n```\n\n::: {.cell-output-display}\n![](slides_files/figure-revealjs/unnamed-chunk-20-1.png){width=960}\n:::\n:::\n\n\n## Scales\n\n<!-- TODO: come up with a worked example for this one -->\n\n-   There are *many* `scale_` functions\n-   Modifying scales is one way to modify legends\n\n## Geoms\n\n-   Every geom has a default stat, but it can be overridden\n-   Not all geoms use the same aesthetics\n-   Worked example: explore the anatomy of a help file (e.g. `?geom_point()`)\n    -   How can you determine the default stat for a geom?\n    -   How can you find out what aesthetics a geom has?\n\n##  {.smaller}\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndf <- expand_grid(x = LETTERS[1:5], y = 1:5)\nggplot(df) +\n  geom_point(aes(x = x, y = y, \n        color = x, shape = x,\n        size = y, alpha = y, stroke = y))\n```\n\n::: {.cell-output-display}\n![](slides_files/figure-revealjs/unnamed-chunk-21-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n::: callout-caution\nWith great power, comes great responsibility!\nIt's not always a *good idea* to map data to aesthetics just because you can.\nStay tuned for part 2 of this series for more!\n:::\n\n## Stats\n\n<!-- NOTE: an alternative to this would be to talk about how the stats of some geoms (e.g. geom_histogram()) actually return multiple values that you can select from with `after_stat()`.  Maybe that is more useful? -->\n\n-   Every stat has a default geom and you *usually* use the `geom_*()` function\n-   Some stats *don't* have an equivalent geom\n-   Worked example: adding mean ± SD on top of jitter plot with `stat_summary()`\n\n::: notes\nmight also demonstrate using a non-default geom for a stat\n:::\n\n## `stat_summary()` key arguments\n\n`fun.data`—A function that is given the complete data and should return a data frame with variables ymin, y, and ymax.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmean_sdl(rnorm(100), mult = 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           y       ymin      ymax\n1 0.06073364 -0.8481342 0.9696015\n```\n\n\n:::\n:::\n\n\n::: callout-note\n`mult` multiplies the standard deviation.\nThe default is `2`.\n:::\n\n. . .\n\n`fun.args`—list of arguments to function in `fun.data` (optional)\n\n. . .\n\n`geom`—default is `\"pointrange\"`, but could be anything that uses `y`, `ymin` and `ymax` aesthetic mappings\n\n##  {.smaller}\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-line-numbers=\"|4-9|5|6|\"}\nset.seed(123)\nggplot(penguins, aes(x = island, y = body_mass_g)) +\n  geom_jitter(alpha = 0.4) +\n  stat_summary(\n    fun.data = \"mean_sdl\",\n    fun.args = list(mult = 1),\n    color = \"blue\",\n    shape = \"square\"\n  )\n```\n\n::: {.cell-output-display}\n![](slides_files/figure-revealjs/unnamed-chunk-23-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n## Use your own function\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-line-numbers=\"|1-3|6\"}\nmedian_80 <- function(vals) {\n   tibble(y = median(vals, na.rm = TRUE), ymin = quantile(vals, 0.1), ymax = quantile(vals, 0.9))\n}\nggplot(penguins, aes(x = island, y = body_mass_g)) +\n  geom_jitter(alpha = 0.4) +\n  stat_summary(fun.data = \"median_80\")\n```\n\n::: {.cell-output-display}\n![](slides_files/figure-revealjs/unnamed-chunk-24-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n## Facets\n\n-   Implemented with `facet_wrap()` and `facet_grid()`\n-   Facets will be explored more in part 2 of this series\n\n## Coords\n\n-   Adjusting x and y limits with `coord_cartesian()` behaves differently than adjusting them with `scale_<x/y>_continuous()`\n-   `coord_polar()` for polar data\n\n## References\n\n::: refs\n:::\n",
    "supporting": [
      "slides_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/countdown-0.4.0/countdown.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/countdown-0.4.0/countdown.js\"></script>\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}